
 <div class"container-fluid top_search">
   <div class="row">
     <div class="col-md-offset-3 col-md-6 top_search form-inline">
         
         <%= form_for @search, url: '/tops/search' do |f| %>
         
         <%= f.text_field :word, class:'form-control', list: "search_history", autocomplete: 'off', size: '60' %>
         <%= f.submit "検索", class: 'btn-lg btn-primary' %>
         <% end %>

     </div>
   </div>
 </div>

<!--ログインしていたら、検索履歴を表示-->
<% if current_user != nil %>
<datalist id="search_history">
    <% @search_history.each do |sh| %>
    <option><%= sh.word%></option>
    <% end %>
</datalist>
<% end %>



<div class="container-fluid result-index-wrapper top_list">
  
    
    <!---検索結果の銘柄一覧--->
    <div class="row">
      <!--検索結果を4つずつ出力-->
      <% @result.uniq.each_slice(4) do |ret_sake1, ret_sake2, ret_sake3, ret_sake4| %>
        <% [ret_sake1, ret_sake2, ret_sake3, ret_sake4].each do |sake| %>
          <div class="col-md-3">
            <% if sake != nil %>
              <div class="thumbnail shadow topic-index-single">
                <%= image_tag sake.image_url.url, class: 'sake' %>
                <br>
                <div class="caption">
                  <h4 class="well"><%= sake.meigara %></h4>
                  
                  <!---いいねのハートマークとカウント,コメントリンク--->
                  <% if !sake.favorite_users.include?(current_user) %>　<!---current_userがいいねしてたら黒、していなかったら空白--->
                    <%= link_to favorites_path(jsake_id: sake.id, now_url: request.url), method: :post do %>
                    <%= image_tag 'icons/blank-heart.png', class: 'sns-icon' %>
                    <% end %>
                  <% else %>
                    <%= link_to unfavorites_path(jsake_id: sake.id, now_url: request.url), method: :delete do %>
                    <%= image_tag 'icons/filled-heart.png', class: 'sns-icon' %>
                    <% end %>
                  <% end %>
                  
                  <%= sake.favorite_users.count %>
                  <%= image_tag 'icons/comment.png', class: 'sns-icon' %>
                  
                    <!---産地～酸度--->
                    <h5>産地：<%= sake.locaility %>&emsp;&emsp;精米歩合：<%= sake.seimai_buai %></h5>
                    <h5>アルコール度数：<%= sake.alcohol_degree %></h5>
                    <h5>日本酒度：<%= sake.sake_meter_value %>&emsp;&emsp;酸度：<%= sake.acidity %></h5>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
    
  
</div>


<!--登録されている銘柄の検索、一覧を表示するためのページです。-->
<!--検索用の入力欄-->
 <div class="container">
   <div class="row">
     <div class="col-md-offset-2 col-md-8 form-inline">
          <%= form_for @search, url: '/tops/search' do |f| %>
         <%= f.text_field :word, class:'form-control', list: "search_history", autocomplete: 'off', size: '85' %>
         <%= f.submit "検索", class: 'btn-lg btn-primary' %>
         <% end %>
     </div>
    </div>
  </div>

<!--ログインしていたら、検索履歴をテキストフィールドに表示-->
<% if current_user != nil %>
  <datalist id="search_history">
    <% @search_history.each do |sh| %>
      <option><%= sh.word%></option>
    <% end %>
  </datalist>
<% end %>


<div class="container-fluid index-with-search">
  <%= will_paginate %>
  
      <!--銘柄全件を4件ずつ表示-->
      <% @result.each_slice(4) do |ret_sake1, ret_sake2, ret_sake3, ret_sake4| %>
        <div class="row index-row">
          <% [ret_sake1, ret_sake2, ret_sake3, ret_sake4].each do |sake|%>
          
            <div class="col-md-3">
              <!--sakeが空白でない場合に実行(each.sliceのエラー対策)-->
              <% if sake != nil %>
                <div class="thumbnail topic-index-single">
                  <!--日本酒画像-->
                  <%= image_tag sake.image_url.url, class: 'sake' %>
                    <!--銘柄のキャプション-->
                    <span class="caption">
                      <!--銘柄名-->
                      <h4><%= sake.meigara %></h4>
                      
                      <!--銘柄のデータ表-->
                      <table class="table text-nowrap">
                        <tr><th>産地</th><td><%= sake.locaility %></td></tr>
                        <tr><th>精米歩合</th><td><%= sake.seimai_buai %></td></tr>
                        <tr><th>アルコール度数</th><td><%= sake.alcohol_degree %></td></tr>
                        <tr><th>日本酒度</th><td><%= sake.sake_meter_value %></td></tr>
                        <tr><th>酸度</th><td><%= sake.acidity %></td></tr>
                      </table>
                      
                      <!--いいねのハートマークとカウント-->
                      <% if !sake.favorite_users.include?(current_user) %>
                        <!---current_userがいいねしていなかったら空白--->
                        <%= link_to favorites_path(jsake_id: sake.id, now_url: request.url), method: :post do %>
                          <%= image_tag 'icons/blank-heart.png', class: 'sns-icon' %>
                        <% end %>
                      <% else %>
                        <!--いいねしてたら赤-->
                        <%= link_to unfavorites_path(jsake_id: sake.id, now_url: request.url), method: :delete do %>
                          <%= image_tag 'icons/red-heart.png', class: 'sns-icon' %>
                        <% end %>
                      <% end %>
                      <!--いいね数の表示-->
                      <span class="badge"><%= sake.favorite_users.count %></span>
                      
                      <!--コメント入力画面へのリンク-->
                      <%= image_tag 'icons/comment.png', class: 'sns-icon' %>
                      
                      <!--アコーディオン形式のコメント欄(モーダル形式を採用の方向)-->
                      <p>
                        <a class="btn btn-primary" data-toggle="collapse" href="#reg_sake<%= sake.id%>" role="button" aria-expanded="false" aria-controls="collapseExample">
                          コメントを見る
                        </a>
                      </p>
                      
                      <div class="collapse" id="reg_sake<%= sake.id%>">
                        <div class="card card-body">
                          <% sake.comments.each do |c|%>
                            <div><%= c.body %></div>
                          <% end %>
                        </div>
                      </div>
                      
                    </span>
                </div>
              <% end %><!--if sake != nilのend -->
            </div>
          <% end %><!--eachのend -->
        </div>
    <% end %><!--each.sliceのend -->
  <%= will_paginate %>
</div>